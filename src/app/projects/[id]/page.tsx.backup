"use client";

import { useEffect, useState } from "react";
import { useParams, useRouter, useSearchParams } from "next/navigation";
import Image from "next/image";
import { useAuth } from "@/hooks/useAuth";
import DashboardLayout from "@/components/layout/DashboardLayout";
import AuthWrapper from "@/components/auth/AuthWrapper";
import { Project, Feedback, UserRole } from "@/types";
import { ProjectWorkflowManager } from "@/lib/projectWorkflow";
import { FeedbackVersionManager } from "@/lib/feedbackVersionManager";
import ModificationRequestManager from "@/components/feedback/ModificationRequestManager";
import FeedbackVersionHistory from "@/components/feedback/FeedbackVersionHistory";
import FileUpload, { UploadedFile } from "@/components/ui/FileUpload";
import { addNotification } from "@/lib/notifications";
import VersionManagerComponent from "@/components/versions/VersionManager";
import CurrentVersionPreview from "@/components/versions/CurrentVersionPreview";
import ModificationCountDisplay from "@/components/modification/ModificationCountDisplay";
import EnhancedVersionUpload from "@/components/versions/EnhancedVersionUpload";
import EnhancedVersionGallery from "@/components/versions/EnhancedVersionGallery";
import EnhancedMarkupCanvas from "@/components/markup/EnhancedMarkupCanvas";
import { initializeMockVersionData } from "@/lib/mockVersionData";
import dynamic from "next/dynamic";

// ë™ì  ì„í¬íŠ¸ë¡œ MarkupFeedbackSystem ë¡œë“œ (SSR ë¹„í™œì„±í™”)
const DynamicMarkupFeedbackSystem = dynamic(
  () => import("@/components/markup/MarkupFeedbackSystem"),
  {
    ssr: false,
    loading: () => (
      <div className="flex items-center justify-center py-12">
        <div className="text-center">
          <div className="loading loading-spinner loading-lg text-primary mb-4"></div>
          <div className="text-base-content/70">ë§ˆí¬ì—… ì‹œìŠ¤í…œì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
        </div>
      </div>
    ),
  }
);
import { VersionManager } from "@/lib/versionManager";

const MOCK_PROJECT: Project = {
  id: "1",
  name: "ë¡œê³  ë””ìì¸ í”„ë¡œì íŠ¸",
  description: "ë¸Œëœë“œ ì•„ì´ë´í‹°í‹°ë¥¼ ìœ„í•œ ë¡œê³  ë””ìì¸ ë° ê°€ì´ë“œë¼ì¸ ì œì‘",
  status: "feedback_period",
  client_id: "1",
  designer_id: "2",
  start_date: "2024-01-15",
  end_date: "2024-02-15",
  draft_deadline: "2024-01-25",
  first_review_deadline: "2024-02-05",
  final_review_deadline: "2024-02-12",
  estimated_price: 2500000,
  budget_used: 1850000,
  total_modification_count: 3,
  remaining_modification_count: 1,
  additional_modification_fee: 50000,
  modification_history: [],
  requirements: "ëª¨ë˜í•˜ê³  ë¯¸ë‹ˆë©€í•œ ìŠ¤íƒ€ì¼ì˜ ë¡œê³ ë¥¼ ì›í•©ë‹ˆë‹¤.",
  created_at: "2024-01-15T09:00:00Z",
  updated_at: "2024-01-20T14:30:00Z",
};

const MOCK_FEEDBACKS: Feedback[] = [
  {
    id: "feedback-1",
    project_id: "1",
    report_id: "report-1",
    content: "ë¡œê³ ì˜ ìƒ‰ìƒì„ ì¢€ ë” ë°ê²Œ ì¡°ì •í•´ì£¼ì„¸ìš”. í˜„ì¬ëŠ” ë„ˆë¬´ ì–´ë‘¡ìŠµë‹ˆë‹¤.",
    content_html:
      "<p>ë¡œê³ ì˜ ìƒ‰ìƒì„ ì¢€ ë” <strong>ë°ê²Œ ì¡°ì •</strong>í•´ì£¼ì„¸ìš”. í˜„ì¬ëŠ” ë„ˆë¬´ ì–´ë‘¡ìŠµë‹ˆë‹¤.</p>",
    priority: "high",
    category: "design",
    status: "pending",
    is_official: true,
    submitted_at: "2024-01-22T10:30:00Z",
    updated_at: "2024-01-22T10:30:00Z",
    client_id: "1",
    version: 1,
    revision_request_count: 0,
  },
  {
    id: "feedback-2",
    project_id: "1",
    report_id: "report-1",
    content: "í°íŠ¸ê°€ ë„ˆë¬´ ë‘êº¼ì›Œ ë³´ì…ë‹ˆë‹¤.",
    content_html:
      "<p>í°íŠ¸ê°€ ë„ˆë¬´ <em>ë‘êº¼ì›Œ</em> ë³´ì…ë‹ˆë‹¤. ì¢€ ë” ì„¸ë ¨ëœ ëŠë‚Œìœ¼ë¡œ ìˆ˜ì • ê°€ëŠ¥í• ê¹Œìš”?</p>",
    priority: "medium",
    category: "design",
    status: "acknowledged",
    is_official: false,
    submitted_at: "2024-01-22T11:00:00Z",
    updated_at: "2024-01-22T11:15:00Z",
    client_id: "1",
    version: 1,
    revision_request_count: 0,
  },
];

export default function EnhancedProjectDetailPage() {
  const params = useParams();
  const router = useRouter();
  const searchParams = useSearchParams();
  const { user } = useAuth();

  const projectId = params?.id as string;
  const userRole: UserRole = user?.role ?? user?.userType ?? "client";

  const [project, setProject] = useState<Project>(MOCK_PROJECT);
  const [feedbacks, setFeedbacks] = useState<Feedback[]>(MOCK_FEEDBACKS);
  const [activeTab, setActiveTab] = useState<string>(
    searchParams.get("tab") || "overview"
  );
  
  // íŒŒì¼ ì—…ë¡œë“œ ìƒíƒœ
  const [uploadingStage, setUploadingStage] = useState<string | null>(null);
  const [draftFiles, setDraftFiles] = useState<File[]>([]);
  const [intermediateFiles, setIntermediateFiles] = useState<File[]>([]);
  const [finalFiles, setFinalFiles] = useState<File[]>([]);
  
  // ê°¤ëŸ¬ë¦¬ ë·° ìƒíƒœ
  const [showAllDrafts, setShowAllDrafts] = useState(false);
  const [showAllIntermediate, setShowAllIntermediate] = useState(false);
  
  // ëª¨ë‹¬ ìƒíƒœ
  const [selectedImage, setSelectedImage] = useState<{
    src: string;
    alt: string;
    title?: string;
    description?: string;
  } | null>(null);
  
  // íŒŒì¼ í•„í„°ë§ ìƒíƒœ
  const [fileSearchTerm, setFileSearchTerm] = useState('');
  const [selectedFileCategory, setSelectedFileCategory] = useState('all');
  const [fileSortBy, setFileSortBy] = useState('date'); // date, name, size
  
  // ì—…ë¡œë“œ ë©”íƒ€ë°ì´í„° ìƒíƒœ
  const [uploadMetadata, setUploadMetadata] = useState<{
    [stage: string]: {
      title: string;
      description: string;
      fileType: string;
    }
  }>({
    draft: { title: '', description: '', fileType: 'general' },
    intermediate: { title: '', description: '', fileType: 'general' },
    final: { title: '', description: '', fileType: 'general' },
  });
  // ëª¨ì˜ ë””ìì¸ ì´ˆì•ˆ íŒŒì¼ë“¤ (ë§ì€ íŒŒì¼ ì‹œë‚˜ë¦¬ì˜¤)
  const mockDraftFiles = Array.from({ length: 15 }, (_, i) => ({
    id: `draft-${i + 1}`,
    name: `logo_design_v${i + 1}.png`,
    preview: `https://picsum.photos/400/300?random=${i + 10}`,
    uploadDate: new Date(2024, 0, 15 + i).toLocaleDateString(),
    size: Math.floor(Math.random() * 5000) + 1000 // KB
  }));

  const mockIntermediateFiles = Array.from({ length: 25 }, (_, i) => ({
    id: `intermediate-${i + 1}`,
    name: i < 8 ? `business_card_v${i + 1}.png` : 
          i < 16 ? `letterhead_v${i - 7}.pdf` : 
          `brochure_v${i - 15}.png`,
    preview: i < 16 ? `https://picsum.photos/400/300?random=${i + 50}` : null,
    uploadDate: new Date(2024, 0, 25 + i).toLocaleDateString(),
    size: Math.floor(Math.random() * 8000) + 2000,
    type: i < 8 ? 'ëª…í•¨' : i < 16 ? 'ë ˆí„°í—¤ë“œ' : 'ë¸Œë¡œì…”'
  }));

  // ëª¨ì˜ í”„ë¡œì íŠ¸ íŒŒì¼ë“¤ (ì‹¤ì œ ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì„ ì‹œë®¬ë ˆì´ì…˜)
  const mockProjectFiles: UploadedFile[] = [
    {
      id: "file-1",
      file: new File(["mock"], "logo_design_v1.png", { type: "image/png" }),
      name: "logo_design_v1.png",
      size: 2456789,
      type: "image/png",
      preview: "https://picsum.photos/400/300?random=1",
      uploadProgress: 100,
      uploadStatus: "completed" as const,
      url: "#"
    },
    {
      id: "file-2",
      file: new File(["mock"], "logo_design_v2.png", { type: "image/png" }),
      name: "logo_design_v2.png",
      size: 2789123,
      type: "image/png",
      preview: "https://picsum.photos/400/300?random=2",
      uploadProgress: 100,
      uploadStatus: "completed" as const,
      url: "#"
    },
    {
      id: "file-3",
      file: new File(["mock"], "brand_guideline.pdf", { type: "application/pdf" }),
      name: "brand_guideline.pdf",
      size: 5234567,
      type: "application/pdf",
      uploadProgress: 100,
      uploadStatus: "completed" as const,
      url: "#"
    },
    {
      id: "file-4",
      file: new File(["mock"], "intermediate_report.pdf", { type: "application/pdf" }),
      name: "intermediate_report.pdf",
      size: 3456789,
      type: "application/pdf",
      uploadProgress: 100,
      uploadStatus: "completed" as const,
      url: "#"
    },
    {
      id: "file-5",
      file: new File(["mock"], "final_deliverables.zip", { type: "application/zip" }),
      name: "final_deliverables.zip",
      size: 12456789,
      type: "application/zip",
      uploadProgress: 100,
      uploadStatus: "completed" as const,
      url: "#"
    }
  ];

  const [projectFiles, setProjectFiles] = useState<UploadedFile[]>(mockProjectFiles);

  // íŒŒì¼ í•„í„°ë§ ë° ì •ë ¬ ë¡œì§
  const getFilteredAndSortedFiles = () => {
    let filtered = projectFiles;

    // ê²€ìƒ‰ì–´ í•„í„°ë§
    if (fileSearchTerm) {
      filtered = filtered.filter(file => 
        file.name.toLowerCase().includes(fileSearchTerm.toLowerCase())
      );
    }

    // ì¹´í…Œê³ ë¦¬ í•„í„°ë§
    if (selectedFileCategory !== 'all') {
      filtered = filtered.filter(file => {
        const getFileCategory = (name: string) => {
          if (name.includes('logo_design')) return 'draft';
          if (name.includes('intermediate')) return 'intermediate';
          if (name.includes('guideline') || name.includes('deliverables')) return 'final';
          return 'other';
        };
        return getFileCategory(file.name) === selectedFileCategory;
      });
    }

    // ì •ë ¬
    filtered.sort((a, b) => {
      switch (fileSortBy) {
        case 'name':
          return a.name.localeCompare(b.name);
        case 'size':
          return b.size - a.size;
        case 'date':
        default:
          return 0; // ëª¨ì˜ ë°ì´í„°ì´ë¯€ë¡œ ë‚ ì§œ ì •ë ¬ì€ ê¸°ë³¸ ìˆœì„œ ìœ ì§€
      }
    });

    return filtered;
  };

  // í”¼ë“œë°± íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”
  useEffect(() => {
    feedbacks.forEach((feedback) => {
      if (!FeedbackVersionManager.getFeedbackHistory(feedback.id)) {
        FeedbackVersionManager.createFeedback(feedback);
      }
    });
  }, [feedbacks]);

  // ì‹œì•ˆ ë²„ì „ Mock ë°ì´í„° ì´ˆê¸°í™”
  useEffect(() => {
    if (projectId) {
      // ê°œë°œ ì¤‘ì—ëŠ” í•­ìƒ ìµœì‹  Mock ë°ì´í„°ë¡œ ìƒˆë¡œê³ ì¹¨
      initializeMockVersionData(projectId, true);
    }
  }, [projectId]);


  const availableActions = ProjectWorkflowManager.getAvailableActions(
    project.status,
    userRole
  );
  const statusInfo = ProjectWorkflowManager.getStatusDisplayInfo(
    project.status
  );
  const progress = ProjectWorkflowManager.calculateProgress(project.status, {
    milestonesCompleted: 2,
    totalMilestones: 4,
    feedbackRounds: feedbacks.filter((f) => f.status === "resolved").length,
  });

  const handleStatusChange = async (actionId: string) => {
    // ì›Œí¬í”Œë¡œìš° ì•¡ì…˜ ì²˜ë¦¬
    const transition = ProjectWorkflowManager.getAvailableTransitions(
      project.status,
      userRole
    ).find((t) => actionId.includes(t.to));

    if (!transition) return;

    const validation = ProjectWorkflowManager.validateTransition(
      project.status,
      transition.to,
      userRole,
      {
        hasDraftFiles: true, // Mock data
        hasFinalDeliverables: actionId === "request_completion",
        hasFeedback: feedbacks.length > 0,
        remainingModifications: project.remaining_modification_count,
      }
    );

    if (!validation.valid) {
      alert(validation.errors.join("\n"));
      return;
    }

    if (transition.requiresConfirmation) {
      const confirmed = confirm(
        `${transition.description}\n\nê³„ì† ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
      );
      if (!confirmed) return;
    }

    // ìƒíƒœ ì—…ë°ì´íŠ¸
    setProject((prev) => ({
      ...prev,
      status: transition.to,
      updated_at: new Date().toISOString(),
    }));

    // ì•Œë¦¼ ì¶”ê°€
    addNotification({
      message: `í”„ë¡œì íŠ¸ê°€ "${
        ProjectWorkflowManager.getStatusDisplayInfo(transition.to).label
      }" ìƒíƒœë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`,
      user_id: user?.id || "",
      url: `/projects/${projectId}`,
    });
  };

  const handleFeedbackSubmit = (
    feedbackData: Omit<
      Feedback,
      "id" | "submitted_at" | "updated_at" | "version"
    >
  ) => {
    const newFeedback: Feedback = {
      ...feedbackData,
      id: Date.now().toString(),
      submitted_at: new Date().toISOString(),
      updated_at: new Date().toISOString(),
      version: 1,
    };

    setFeedbacks((prev) => [...prev, newFeedback]);
    FeedbackVersionManager.createFeedback(newFeedback);

    addNotification({
      message: "ìƒˆë¡œìš´ í”¼ë“œë°±ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.",
      user_id: user?.id || "",
      url: `/projects/${projectId}?tab=feedback`,
    });
  };


  const handleFeedbackStatusChange = (
    feedbackId: string,
    status: Feedback["status"]
  ) => {
    const updatedFeedbacks = feedbacks.map((f) =>
      f.id === feedbackId
        ? { ...f, status, updated_at: new Date().toISOString() }
        : f
    );

    setFeedbacks(updatedFeedbacks);

    FeedbackVersionManager.updateFeedback(
      feedbackId,
      { status },
      user?.id || ""
    );
  };

  const handleFilesUpload = (newFiles: UploadedFile[]) => {
    setProjectFiles((prev) => [...prev, ...newFiles]);
    addNotification({
      message: `${newFiles.length}ê°œì˜ íŒŒì¼ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`,
      user_id: user?.id || "",
      url: `/projects/${projectId}?tab=files`,
    });
  };

  const handleFileRemove = (fileId: string) => {
    setProjectFiles((prev) => prev.filter((f) => f.id !== fileId));
  };

  // íŒŒì¼ ë‹¤ìš´ë¡œë“œ (ëª¨ì˜ êµ¬í˜„)
  const handleFileDownload = (file: UploadedFile | { name: string; [key: string]: unknown }) => {
    // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„œë²„ì—ì„œ íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œ
    console.log('íŒŒì¼ ë‹¤ìš´ë¡œë“œ:', file.name);
    addNotification({
      message: `${file.name} ë‹¤ìš´ë¡œë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.`,
      user_id: user?.id || "",
      url: `/projects/${projectId}?tab=files`,
    });
  };

  // íŒŒì¼ ê³µìœ  ë§í¬ ìƒì„± (ëª¨ì˜ êµ¬í˜„)
  const handleFileShare = (file: UploadedFile | { id: string; name: string; [key: string]: unknown }) => {
    const shareLink = `${window.location.origin}/projects/${projectId}/files/${file.id}`;
    navigator.clipboard.writeText(shareLink);
    addNotification({
      message: `${file.name}ì˜ ê³µìœ  ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤.`,
      user_id: user?.id || "",
      url: `/projects/${projectId}?tab=files`,
    });
  };

  // íŒŒì¼ ì„ íƒ í•¸ë“¤ëŸ¬
  const handleFileSelect = (stage: string) => (event: React.ChangeEvent<HTMLInputElement>) => {
    const files = event.target.files;
    if (files) {
      const fileArray = Array.from(files);
      switch (stage) {
        case 'draft':
          setDraftFiles(fileArray);
          break;
        case 'intermediate':
          setIntermediateFiles(fileArray);
          break;
        case 'final':
          setFinalFiles(fileArray);
          break;
      }
      
      // íŒŒì¼ ì„ íƒ í›„ ì—…ë¡œë“œ ìƒíƒœ í‘œì‹œ
      setUploadingStage(stage);
      console.log(`${stage} íŒŒì¼ ì„ íƒë¨:`, fileArray);
    }
  };

  // íŒŒì¼ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬
  const handleUpload = async (stage: string, title?: string, description?: string, fileType?: string) => {
    let files: File[] = [];
    switch (stage) {
      case 'draft':
        files = draftFiles;
        break;
      case 'intermediate':
        files = intermediateFiles;
        break;
      case 'final':
        files = finalFiles;
        break;
    }

    if (files.length === 0) {
      alert('ë¨¼ì € íŒŒì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
      return;
    }

    // ì—…ë¡œë“œ ì‹œë®¬ë ˆì´ì…˜
    setUploadingStage(stage);
    console.log(`${stage} íŒŒì¼ ì—…ë¡œë“œ ì¤‘:`, files);
    
    // ì‹¤ì œë¡œëŠ” ì„œë²„ API í˜¸ì¶œ
    try {
      // ì—…ë¡œë“œëœ íŒŒì¼ë“¤ì„ projectFilesì— ì¶”ê°€ (ëª¨ì˜ êµ¬í˜„)
      const newUploadedFiles: UploadedFile[] = files.map((file, index) => {
        const isImage = file.type.startsWith('image/');
        return {
          id: `uploaded-${Date.now()}-${index}`,
          file: file,
          name: file.name,
          size: file.size,
          type: file.type,
          preview: isImage ? URL.createObjectURL(file) : undefined,
          uploadProgress: 100,
          uploadStatus: "completed" as const,
          url: "#",
          metadata: {
            title: title || file.name,
            description: description || `${stage} ë‹¨ê³„ íŒŒì¼`,
            fileType: fileType || 'general',
            uploadedAt: new Date().toISOString()
          }
        };
      });

      // 2ì´ˆ í›„ íŒŒì¼ì„ ëª©ë¡ì— ì¶”ê°€
      setTimeout(() => {
        setProjectFiles((prev) => [...prev, ...newUploadedFiles]);
        setUploadingStage(null);
        
        // ì—…ë¡œë“œ ì™„ë£Œ í›„ íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
        switch (stage) {
          case 'draft':
            setDraftFiles([]);
            break;
          case 'intermediate':
            setIntermediateFiles([]);
            break;
          case 'final':
            setFinalFiles([]);
            break;
        }
        
        addNotification({
          message: `${files.length}ê°œì˜ ${stage === 'draft' ? 'ë””ìì¸ ì´ˆì•ˆ' : stage === 'intermediate' ? 'ì¤‘ê°„ ì‘ì—…ë¬¼' : 'ìµœì¢… ê²°ê³¼ë¬¼'}ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`,
          user_id: user?.id || "",
          url: `/projects/${projectId}?tab=files`,
        });
      }, 2000);
    } catch {
      setUploadingStage(null);
      alert('ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    }
  };

  const renderTabContent = () => {
    switch (activeTab) {
      case "overview":
        return (
          <div className="space-y-6">
            {/* ìˆ˜ì • íšŸìˆ˜ í˜„í™© */}
            <ModificationCountDisplay 
              projectId={projectId}
              onLimitExceeded={() => {
                addNotification({
                  message: "âš ï¸ ìˆ˜ì • íšŸìˆ˜ë¥¼ ëª¨ë‘ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤. ì¶”ê°€ ìˆ˜ì •ì€ ë³„ë„ ë¹„ìš©ì´ ë°œìƒí•©ë‹ˆë‹¤.",
                  user_id: user?.id || "",
                  url: `/projects/${projectId}`,
                });
              }}
              onWarning={() => {
                addNotification({
                  message: "ğŸ”” ìˆ˜ì • íšŸìˆ˜ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ì‹ ì¤‘í•˜ê²Œ ì‚¬ìš©í•´ì£¼ì„¸ìš”.",
                  user_id: user?.id || "",
                  url: `/projects/${projectId}`,
                });
              }}
            />
            
            {/* í”„ë¡œì íŠ¸ ê¸°ë³¸ ì •ë³´ */}
            <div className="card bg-base-100 shadow-sm">
              <div className="card-body">
                <h3 className="text-lg font-semibold mb-4">í”„ë¡œì íŠ¸ ì •ë³´</h3>
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div>
                    <h4 className="font-medium mb-2">ê¸°ë³¸ ì •ë³´</h4>
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between">
                        <span>í”„ë¡œì íŠ¸ëª…:</span>
                        <span className="font-medium">{project.name}</span>
                      </div>
                      <div className="flex justify-between">
                        <span>ì˜ˆìƒ ê¸ˆì•¡:</span>
                        <span className="font-medium">
                          {project.estimated_price.toLocaleString()}ì›
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span>ìˆ˜ì • íšŸìˆ˜:</span>
                        <span
                          className={`font-medium ${
                            project.remaining_modification_count === 0
                              ? "text-error"
                              : "text-success"
                          }`}
                        >
                          {project.remaining_modification_count}/
                          {project.total_modification_count}
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span>ì¶”ê°€ ìˆ˜ì • ìš”ê¸ˆ:</span>
                        <span className="font-medium text-warning">
                          {project.additional_modification_fee.toLocaleString()}ì›/íšŒ
                        </span>
                      </div>
                    </div>
                  </div>

                  <div>
                    <h4 className="font-medium mb-2">ì¼ì •</h4>
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between">
                        <span>ì‹œì‘ì¼:</span>
                        <span>
                          {new Date(project.start_date).toLocaleDateString()}
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span>ë§ˆê°ì¼:</span>
                        <span>
                          {new Date(project.end_date).toLocaleDateString()}
                        </span>
                      </div>
                      <div className="flex justify-between">
                        <span>ì´ˆì•ˆ ë§ˆê°:</span>
                        <span>
                          {new Date(
                            project.draft_deadline
                          ).toLocaleDateString()}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="mt-6">
                  <h4 className="font-medium mb-2">ìš”êµ¬ì‚¬í•­</h4>
                  <p className="text-sm text-base-content/80 bg-base-200 p-3 rounded">
                    {project.requirements}
                  </p>
                </div>
              </div>
            </div>

            <div className="card bg-base-100 shadow-sm">
              <div className="card-body">
                <div className="flex items-center justify-between mb-4">
                  <h3 className="text-lg font-semibold">ì§„í–‰ í˜„í™©</h3>
                  <span className="badge badge-primary badge-lg">
                    {statusInfo.icon} {statusInfo.label}
                  </span>
                </div>

                <div className="mb-4">
                  <div className="flex justify-between text-sm mb-2">
                    <span>ì „ì²´ ì§„í–‰ë¥ </span>
                    <span className="font-medium">{progress}%</span>
                  </div>
                  <progress
                    className={`progress progress-${
                      statusInfo.color === "success" ? "success" : "primary"
                    } w-full`}
                    value={progress}
                    max="100"
                  />
                </div>

                <p className="text-sm text-base-content/70">
                  {statusInfo.description}
                </p>
              </div>
            </div>

            <CurrentVersionPreview 
              projectId={projectId}
              onViewVersions={() => setActiveTab("versions")}
            />

            {availableActions.length > 0 && (
              <div className="card bg-base-100 shadow-sm">
                <div className="card-body">
                  <h3 className="text-lg font-semibold mb-4">ê°€ëŠ¥í•œ ì‘ì—…</h3>
                  <div className="flex flex-wrap gap-2">
                    {availableActions.map((action) => (
                      <button
                        key={action.id}
                        onClick={() => handleStatusChange(action.id)}
                        className={`btn btn-${action.variant}`}
                      >
                        {action.icon} {action.label}
                      </button>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        );

      case "feedback":
        const currentVersion = VersionManager.getCurrentVersion(projectId);
        
        return (
          <div className="space-y-8">
            {/* ê°œì„ ëœ ë§ˆí¬ì—… í”¼ë“œë°± ì‹œìŠ¤í…œ */}
            {currentVersion && (
              <EnhancedMarkupCanvas
                version={currentVersion}
                projectId={projectId}
                userRole={userRole}
                currentUserId={user?.id || "current-user"}
                onFeedbackCreate={(feedback) => {
                  addNotification({
                    message: `ìƒˆë¡œìš´ í”¼ë“œë°± '${feedback.title}'ì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                    user_id: user?.id || "",
                    url: `/projects/${projectId}?tab=feedback`,
                  });
                }}
                onFeedbackUpdate={(feedback) => {
                  addNotification({
                    message: `í”¼ë“œë°± '${feedback.title}'ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                    user_id: user?.id || "",
                    url: `/projects/${projectId}?tab=feedback`,
                  });
                }}
                onMarkupDelete={(markup) => {
                  addNotification({
                    message: `ë§ˆí¬ì—… #${markup.number}ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                    user_id: user?.id || "",
                    url: `/projects/${projectId}?tab=feedback`,
                  });
                }}
              />
            )}

            {/* êµ¬ë¶„ì„  */}
            <div className="divider">
              <span className="text-base-content/60">ê¸°ì¡´ í”¼ë“œë°± ì‹œìŠ¤í…œ</span>
            </div>

            {/* ê¸°ì¡´ ìˆ˜ì •ìš”ì²­ ê´€ë¦¬ ì‹œìŠ¤í…œ */}
            <ModificationRequestManager
              projectId={projectId}
              reportId="report-1"
              isDesigner={userRole === "designer"}
              onModificationRequestSubmit={(data) => {
                // ìˆ˜ì •ìš”ì²­ì´ ì œì¶œë˜ì—ˆì„ ë•Œì˜ ì²˜ë¦¬
                console.log("New modification request submitted:", data);
                
                addNotification({
                  message: "ìƒˆë¡œìš´ ìˆ˜ì •ìš”ì²­ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤.",
                  user_id: user?.id || "",
                  url: `/projects/${projectId}?tab=feedback`,
                });
              }}
            />
          </div>
        );

      case "versions":
        return (
          <div className="space-y-8">
            {/* ìƒˆ ì‹œì•ˆ ì—…ë¡œë“œ (ë””ìì´ë„ˆë§Œ) */}
            {userRole === "designer" && (
              <EnhancedVersionUpload
                projectId={projectId}
                currentUserId={user?.id || ""}
                onVersionCreated={(version) => {
                  addNotification({
                    message: `ì‹œì•ˆ v${version.version_number} '${version.title}'ì´ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                    user_id: user?.id || "",
                    url: `/projects/${projectId}?tab=versions`,
                  });
                }}
                onError={(error) => {
                  addNotification({
                    message: `ì—…ë¡œë“œ ì˜¤ë¥˜: ${error}`,
                    user_id: user?.id || "",
                    url: `/projects/${projectId}?tab=versions`,
                  });
                }}
              />
            )}
            
            {/* ê°œì„ ëœ ì‹œì•ˆ ê°¤ëŸ¬ë¦¬ */}
            <EnhancedVersionGallery
              projectId={projectId}
              userRole={userRole}
              currentUserId={user?.id || ""}
              onVersionSelect={(version) => {
                // ì‹œì•ˆ ìƒì„¸ë³´ê¸°
                addNotification({
                  message: `ì‹œì•ˆ v${version.version_number}ì„ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤.`,
                  user_id: user?.id || "",
                  url: `/projects/${projectId}?tab=versions`,
                });
              }}
              onVersionApprove={(version) => {
                addNotification({
                  message: `ì‹œì•ˆ v${version.version_number}ì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`,
                  user_id: user?.id || "",
                  url: `/projects/${projectId}?tab=versions`,
                });
              }}
              onVersionDelete={(version) => {
                addNotification({
                  message: `ì‹œì•ˆ v${version.version_number}ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.`,
                  user_id: user?.id || "",
                  url: `/projects/${projectId}?tab=versions`,
                });
              }}
              onVersionCompare={(versionA, versionB) => {
                addNotification({
                  message: `ì‹œì•ˆ v${versionA.version_number}ê³¼ v${versionB.version_number}ë¥¼ ë¹„êµ ì¤‘ì…ë‹ˆë‹¤.`,
                  user_id: user?.id || "",
                  url: `/projects/${projectId}?tab=versions`,
                });
              }}
            />
          </div>
        );

      case "files":
        return (
          <div className="space-y-6">
            <div className="flex items-center justify-between">
              <h3 className="text-lg font-semibold">íŒŒì¼ ë° ìë£Œ</h3>
              <div className="text-sm text-base-content/60">
                {fileSearchTerm || selectedFileCategory !== 'all' 
                  ? `ê²€ìƒ‰ ê²°ê³¼: ${getFilteredAndSortedFiles().length}ê°œ (ì „ì²´ ${projectFiles.length}ê°œ)`
                  : `ì´ ${projectFiles.length}ê°œ íŒŒì¼`
                }
              </div>
            </div>

            {/* íŒŒì¼ ê²€ìƒ‰ ë° í•„í„° */}
            <div className="card bg-base-100 shadow-sm mb-6">
              <div className="card-body py-4">
                <div className="flex flex-col md:flex-row gap-4 items-center">
                  <div className="flex-1">
                    <input
                      type="text"
                      placeholder="íŒŒì¼ëª…ìœ¼ë¡œ ê²€ìƒ‰..."
                      className="input input-bordered input-sm w-full"
                      value={fileSearchTerm}
                      onChange={(e) => setFileSearchTerm(e.target.value)}
                    />
                  </div>
                  <div className="flex space-x-2">
                    <select 
                      className="select select-bordered select-sm"
                      value={selectedFileCategory}
                      onChange={(e) => setSelectedFileCategory(e.target.value)}
                    >
                      <option value="all">ì „ì²´ íŒŒì¼</option>
                      <option value="draft">ë””ìì¸ ì´ˆì•ˆ</option>
                      <option value="intermediate">ì¤‘ê°„ ì‘ì—…ë¬¼</option>
                      <option value="final">ìµœì¢… ê²°ê³¼ë¬¼</option>
                    </select>
                    <select 
                      className="select select-bordered select-sm"
                      value={fileSortBy}
                      onChange={(e) => setFileSortBy(e.target.value)}
                    >
                      <option value="date">ë‚ ì§œìˆœ</option>
                      <option value="name">ì´ë¦„ìˆœ</option>
                      <option value="size">í¬ê¸°ìˆœ</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

            {/* ì‘ì—… ì§„í–‰ ë‹¨ê³„ë³„ ì´ë¯¸ì§€ ê°¤ëŸ¬ë¦¬ */}
            <div className="space-y-8 mb-8">
              <h3 className="text-xl font-bold flex items-center space-x-2">
                <span>ğŸ¯</span>
                <span>ì‘ì—… ì§„í–‰ ìƒí™©</span>
              </h3>
              
              {/* 1ë‹¨ê³„: ë””ìì¸ ì´ˆì•ˆ */}
              <div className="card bg-gradient-to-r from-primary/5 to-primary/10 shadow-sm">
                <div className="card-body">
                  <div className="flex items-center space-x-3 mb-6">
                    <div className="w-8 h-8 bg-primary text-primary-content rounded-full flex items-center justify-center font-bold">1</div>
                    <div>
                      <h4 className="text-lg font-semibold">ë””ìì¸ ì´ˆì•ˆ</h4>
                      <p className="text-sm text-base-content/70">2024.01.20 - 2024.01.23</p>
                    </div>
                    <div className="badge badge-primary">ì™„ë£Œ</div>
                  </div>
                  
                  {/* íŒŒì¼ ê°¤ëŸ¬ë¦¬ */}
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm font-medium">ì—…ë¡œë“œëœ ì´ˆì•ˆ: {mockDraftFiles.length}ê°œ</span>
                      <button 
                        className="btn btn-ghost btn-xs"
                        onClick={() => setShowAllDrafts(!showAllDrafts)}
                      >
                        {showAllDrafts ? 'ì ‘ê¸°' : 'ì „ì²´ë³´ê¸°'} 
                        <span className="ml-1">{showAllDrafts ? 'â–²' : 'â–¼'}</span>
                      </button>
                    </div>
                    
                    <div className={`grid ${showAllDrafts ? 'grid-cols-2 md:grid-cols-3 lg:grid-cols-4' : 'grid-cols-2 md:grid-cols-4'} gap-3`}>
                      {(showAllDrafts ? mockDraftFiles : mockDraftFiles.slice(0, 4)).map((file, index) => (
                        <div key={file.id} className="bg-base-100 p-3 rounded-lg hover:shadow-md transition-shadow">
                          <div className="relative">
                            <Image 
                              src={file.preview} 
                              alt={file.name}
                              width={200}
                              height={showAllDrafts ? 96 : 128}
                              className={`w-full ${showAllDrafts ? 'h-24' : 'h-32'} object-cover rounded cursor-pointer`}
                              onClick={() => setSelectedImage({
                                src: file.preview,
                                alt: file.name,
                                title: file.name,
                                description: `ì—…ë¡œë“œì¼: ${file.uploadDate}, í¬ê¸°: ${file.size}KB`
                              })}
                            />
                            <div className="absolute top-1 right-1 bg-black/50 text-white text-xs px-1 rounded">
                              V{index + 1}
                            </div>
                          </div>
                          <div className="mt-2">
                            <p className="text-xs font-medium truncate" title={file.name}>
                              {file.name}
                            </p>
                            <div className="flex items-center justify-between mt-1">
                              <span className="text-xs text-base-content/60">{file.uploadDate}</span>
                              <span className="text-xs text-base-content/60">{file.size}KB</span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    {!showAllDrafts && mockDraftFiles.length > 4 && (
                      <div className="text-center">
                        <button 
                          className="btn btn-ghost btn-sm"
                          onClick={() => setShowAllDrafts(true)}
                        >
                          +{mockDraftFiles.length - 4}ê°œ ë”ë³´ê¸°
                        </button>
                      </div>
                    )}
                  </div>
                  
                  {userRole === "designer" && (
                    <div className="mt-4 p-4 border-2 border-dashed border-primary/30 rounded-lg bg-primary/5">
                      <div className="flex items-center justify-between mb-3">
                        <h5 className="text-sm font-medium flex items-center space-x-2">
                          <span>ğŸ“</span>
                          <span>ìƒˆ ì´ˆì•ˆ ì—…ë¡œë“œ</span>
                        </h5>
                      </div>
                      <div className="space-y-3">
                        <input 
                          type="text" 
                          placeholder="ì‘ì—…ë¬¼ ì´ë¦„ (ì˜ˆ: ë¡œê³  ì´ˆì•ˆ V3)" 
                          className="input input-sm input-bordered w-full"
                          value={uploadMetadata.draft.title}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            draft: { ...prev.draft, title: e.target.value }
                          }))}
                        />
                        <textarea 
                          placeholder="ì‘ì—…ë¬¼ ì„¤ëª… (ì˜ˆ: ìƒ‰ìƒ í†¤ì„ ì¡°ì •í•˜ê³  í°íŠ¸ë¥¼ ë³€ê²½í•œ ë²„ì „)" 
                          className="textarea textarea-sm textarea-bordered w-full h-16"
                          value={uploadMetadata.draft.description}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            draft: { ...prev.draft, description: e.target.value }
                          }))}
                        />
                        <div className="flex space-x-2">
                          <input
                            type="file"
                            id="draft-file-input"
                            className="hidden"
                            multiple
                            accept="image/*,.pdf,.ai,.psd"
                            onChange={handleFileSelect('draft')}
                          />
                          <button 
                            className="btn btn-primary btn-sm"
                            onClick={() => document.getElementById('draft-file-input')?.click()}
                          >
                            <span>ğŸ“</span>
                            íŒŒì¼ ì„ íƒ
                            {draftFiles.length > 0 && ` (${draftFiles.length}ê°œ)`}
                          </button>
                          <button 
                            className="btn btn-ghost btn-sm"
                            onClick={() => handleUpload('draft', uploadMetadata.draft.title, uploadMetadata.draft.description, uploadMetadata.draft.fileType)}
                            disabled={uploadingStage === 'draft'}
                          >
                            {uploadingStage === 'draft' ? (
                              <>
                                <span className="loading loading-spinner loading-sm"></span>
                                ì—…ë¡œë“œ ì¤‘...
                              </>
                            ) : (
                              'ì—…ë¡œë“œ'
                            )}
                          </button>
                        </div>
                        
                        {/* ì„ íƒëœ íŒŒì¼ ë¯¸ë¦¬ë³´ê¸° */}
                        {draftFiles.length > 0 && (
                          <div className="mt-3 p-3 bg-base-200 rounded">
                            <p className="text-sm font-medium mb-2">ì„ íƒëœ íŒŒì¼:</p>
                            <div className="space-y-1">
                              {draftFiles.map((file, index) => (
                                <div key={index} className="flex items-center space-x-2 text-sm">
                                  <span>ğŸ“„</span>
                                  <span className="truncate">{file.name}</span>
                                  <span className="text-xs text-base-content/60">
                                    ({Math.round(file.size / 1024)}KB)
                                  </span>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    </div>
                  )}
                  
                  {userRole === "client" && (
                    <div className="mt-4 p-4 border-2 border-dashed border-accent/30 rounded-lg bg-accent/5">
                      <div className="flex items-center justify-between mb-3">
                        <h5 className="text-sm font-medium flex items-center space-x-2">
                          <span>ğŸ’¬</span>
                          <span>í”¼ë“œë°± ë‚¨ê¸°ê¸°</span>
                        </h5>
                      </div>
                      <div className="space-y-3">
                        <div className="flex items-center space-x-4">
                          <label className="cursor-pointer label flex items-center space-x-2">
                            <input type="radio" name="feedback-type" className="radio radio-success radio-sm" />
                            <span className="text-sm">ìŠ¹ì¸</span>
                          </label>
                          <label className="cursor-pointer label flex items-center space-x-2">
                            <input type="radio" name="feedback-type" className="radio radio-warning radio-sm" />
                            <span className="text-sm">ìˆ˜ì • ìš”ì²­</span>
                          </label>
                        </div>
                        <textarea 
                          placeholder="í”¼ë“œë°±ì„ ì…ë ¥í•˜ì„¸ìš” (ì˜ˆ: ì „ì²´ì ìœ¼ë¡œ ë§Œì¡±ìŠ¤ëŸ½ìŠµë‹ˆë‹¤. ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•´ì£¼ì„¸ìš”.)" 
                          className="textarea textarea-sm textarea-bordered w-full h-20"
                        />
                        <button className="btn btn-accent btn-sm">í”¼ë“œë°± ì œì¶œ</button>
                      </div>
                    </div>
                  )}
                </div>
              </div>

              {/* 2ë‹¨ê³„: ì¤‘ê°„ ì‘ì—…ë¬¼ */}
              <div className="card bg-gradient-to-r from-warning/5 to-warning/10 shadow-sm">
                <div className="card-body">
                  <div className="flex items-center space-x-3 mb-6">
                    <div className="w-8 h-8 bg-warning text-warning-content rounded-full flex items-center justify-center font-bold">2</div>
                    <div>
                      <h4 className="text-lg font-semibold">ì¤‘ê°„ ì‘ì—…ë¬¼</h4>
                      <p className="text-sm text-base-content/70">2024.01.25 - 2024.02.05</p>
                    </div>
                    <div className="badge badge-warning">ì§„í–‰ì¤‘</div>
                  </div>
                  
                  {/* ì¤‘ê°„ ì‘ì—…ë¬¼ ê°¤ëŸ¬ë¦¬ */}
                  <div className="space-y-4">
                    <div className="flex items-center justify-between">
                      <span className="text-sm font-medium">ì¤‘ê°„ ì‘ì—…ë¬¼: {mockIntermediateFiles.length}ê°œ</span>
                      <button 
                        className="btn btn-ghost btn-xs"
                        onClick={() => setShowAllIntermediate(!showAllIntermediate)}
                      >
                        {showAllIntermediate ? 'ì ‘ê¸°' : 'ì „ì²´ë³´ê¸°'} 
                        <span className="ml-1">{showAllIntermediate ? 'â–²' : 'â–¼'}</span>
                      </button>
                    </div>
                    
                    {/* ìœ í˜•ë³„ í•„í„° íƒ­ */}
                    <div className="flex space-x-2 overflow-x-auto">
                      <div className="badge badge-outline">ì „ì²´ {mockIntermediateFiles.length}</div>
                      <div className="badge badge-outline">ëª…í•¨ {mockIntermediateFiles.filter(f => f.type === 'ëª…í•¨').length}</div>
                      <div className="badge badge-outline">ë ˆí„°í—¤ë“œ {mockIntermediateFiles.filter(f => f.type === 'ë ˆí„°í—¤ë“œ').length}</div>
                      <div className="badge badge-outline">ë¸Œë¡œì…” {mockIntermediateFiles.filter(f => f.type === 'ë¸Œë¡œì…”').length}</div>
                    </div>
                    
                    <div className={`grid ${showAllIntermediate ? 'grid-cols-2 md:grid-cols-4 lg:grid-cols-6' : 'grid-cols-3 md:grid-cols-6'} gap-3`}>
                      {(showAllIntermediate ? mockIntermediateFiles : mockIntermediateFiles.slice(0, 6)).map((file) => (
                        <div key={file.id} className="bg-base-100 p-2 rounded-lg hover:shadow-md transition-shadow">
                          <div className="relative">
                            {file.preview ? (
                              <Image 
                                src={file.preview} 
                                alt={file.name}
                                width={150}
                                height={showAllIntermediate ? 80 : 96}
                                className={`w-full ${showAllIntermediate ? 'h-20' : 'h-24'} object-cover rounded cursor-pointer`}
                                onClick={() => setSelectedImage({
                                  src: file.preview || '',
                                  alt: file.name,
                                  title: `${file.type} - ${file.name}`,
                                  description: `ì—…ë¡œë“œì¼: ${file.uploadDate}, í¬ê¸°: ${file.size}KB`
                                })}
                              />
                            ) : (
                              <div className={`w-full ${showAllIntermediate ? 'h-20' : 'h-24'} bg-warning/10 rounded flex items-center justify-center`}>
                                <span className="text-2xl">ğŸ“„</span>
                              </div>
                            )}
                            <div className="absolute top-1 right-1 bg-warning text-warning-content text-xs px-1 rounded">
                              {file.type}
                            </div>
                          </div>
                          <div className="mt-2">
                            <p className="text-xs font-medium truncate" title={file.name}>
                              {file.name}
                            </p>
                            <div className="flex items-center justify-between mt-1">
                              <span className="text-xs text-base-content/60">{file.uploadDate}</span>
                              <span className="text-xs text-base-content/60">{file.size}KB</span>
                            </div>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    {!showAllIntermediate && mockIntermediateFiles.length > 6 && (
                      <div className="text-center">
                        <button 
                          className="btn btn-ghost btn-sm"
                          onClick={() => setShowAllIntermediate(true)}
                        >
                          +{mockIntermediateFiles.length - 6}ê°œ ë”ë³´ê¸°
                        </button>
                      </div>
                    )}
                  </div>
                  
                  {userRole === "designer" && (
                    <div className="mt-4 p-4 border-2 border-dashed border-warning/30 rounded-lg bg-warning/5">
                      <div className="flex items-center justify-between mb-3">
                        <h5 className="text-sm font-medium flex items-center space-x-2">
                          <span>ğŸ“</span>
                          <span>ì¤‘ê°„ ì‘ì—…ë¬¼ ì—…ë¡œë“œ</span>
                        </h5>
                      </div>
                      <div className="space-y-3">
                        <select 
                          className="select select-sm select-bordered w-full"
                          value={uploadMetadata.intermediate.fileType}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            intermediate: { ...prev.intermediate, fileType: e.target.value }
                          }))}
                        >
                          <option disabled value="general">ì‘ì—…ë¬¼ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                          <option value="business-card">ëª…í•¨ ë””ìì¸</option>
                          <option value="letterhead">ë ˆí„°í—¤ë“œ</option>
                          <option value="brochure">ë¸Œë¡œì…” ë””ìì¸</option>
                          <option value="packaging">íŒ¨í‚¤ì§• ë””ìì¸</option>
                          <option value="other">ê¸°íƒ€</option>
                        </select>
                        <input 
                          type="text" 
                          placeholder="ì‘ì—…ë¬¼ ì´ë¦„ (ì˜ˆ: ëª…í•¨ ë””ìì¸ ìµœì¢…ì•ˆ)" 
                          className="input input-sm input-bordered w-full"
                          value={uploadMetadata.intermediate.title}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            intermediate: { ...prev.intermediate, title: e.target.value }
                          }))}
                        />
                        <textarea 
                          placeholder="ì‘ì—…ë¬¼ ì„¤ëª… ë° íŠ¹ì§• (ì˜ˆ: ì–‘ë©´ ëª…í•¨, ë¬´ê´‘ ì½”íŒ… ì ìš©)" 
                          className="textarea textarea-sm textarea-bordered w-full h-16"
                          value={uploadMetadata.intermediate.description}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            intermediate: { ...prev.intermediate, description: e.target.value }
                          }))}
                        />
                        <div className="flex space-x-2">
                          <input
                            type="file"
                            id="intermediate-file-input"
                            className="hidden"
                            multiple
                            accept="image/*,.pdf,.ai,.psd"
                            onChange={handleFileSelect('intermediate')}
                          />
                          <button 
                            className="btn btn-warning btn-sm"
                            onClick={() => document.getElementById('intermediate-file-input')?.click()}
                          >
                            <span>ğŸ“</span>
                            íŒŒì¼ ì„ íƒ
                            {intermediateFiles.length > 0 && ` (${intermediateFiles.length}ê°œ)`}
                          </button>
                          <button 
                            className="btn btn-ghost btn-sm"
                            onClick={() => handleUpload('intermediate', uploadMetadata.intermediate.title, uploadMetadata.intermediate.description, uploadMetadata.intermediate.fileType)}
                            disabled={uploadingStage === 'intermediate'}
                          >
                            {uploadingStage === 'intermediate' ? (
                              <>
                                <span className="loading loading-spinner loading-sm"></span>
                                ì—…ë¡œë“œ ì¤‘...
                              </>
                            ) : (
                              'ì—…ë¡œë“œ'
                            )}
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  {userRole === "client" && (
                    <div className="mt-4 p-3 bg-info/10 rounded-lg">
                      <p className="text-sm text-info-content">
                        ğŸ’¬ ë””ìì´ë„ˆê°€ ì‘ì—…ë¬¼ì„ ì—…ë¡œë“œí•˜ë©´ ê²€í†  í›„ í”¼ë“œë°±ì„ ë‚¨ê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                      </p>
                    </div>
                  )}
                </div>
              </div>

              {/* 3ë‹¨ê³„: ìµœì¢… ê²°ê³¼ë¬¼ */}
              <div className="card bg-gradient-to-r from-neutral/5 to-neutral/10 shadow-sm">
                <div className="card-body">
                  <div className="flex items-center space-x-3 mb-6">
                    <div className="w-8 h-8 bg-neutral text-neutral-content rounded-full flex items-center justify-center font-bold">3</div>
                    <div>
                      <h4 className="text-lg font-semibold">ìµœì¢… ê²°ê³¼ë¬¼</h4>
                      <p className="text-sm text-base-content/70">2024.02.10 - 2024.02.15 (ì˜ˆì •)</p>
                    </div>
                    <div className="badge badge-neutral">ëŒ€ê¸°ì¤‘</div>
                  </div>
                  
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div className="space-y-2">
                      <div className="bg-base-100 p-4 rounded-lg border-2 border-dashed border-neutral">
                        <div className="w-full h-48 bg-neutral/10 rounded flex items-center justify-center">
                          <div className="text-center">
                            <div className="text-4xl mb-2">ğŸ“¦</div>
                            <p className="text-sm font-medium">ì™„ì„±ëœ ë¡œê³  íŒ¨í‚¤ì§€</p>
                            <p className="text-xs text-base-content/60">AI, PNG, SVG íŒŒì¼</p>
                          </div>
                        </div>
                      </div>
                    </div>
                    
                    <div className="space-y-2">
                      <div className="bg-base-100 p-4 rounded-lg border-2 border-dashed border-neutral">
                        <div className="w-full h-48 bg-neutral/10 rounded flex items-center justify-center">
                          <div className="text-center">
                            <div className="text-4xl mb-2">ğŸ“‹</div>
                            <p className="text-sm font-medium">ë¸Œëœë“œ ê°€ì´ë“œë¼ì¸</p>
                            <p className="text-xs text-base-content/60">ì‚¬ìš©ë²• ë° ê·œì •</p>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  {userRole === "designer" && (
                    <div className="mt-4 p-4 border-2 border-dashed border-neutral/30 rounded-lg bg-neutral/5">
                      <div className="flex items-center justify-between mb-3">
                        <h5 className="text-sm font-medium flex items-center space-x-2">
                          <span>ğŸ“</span>
                          <span>ìµœì¢… ê²°ê³¼ë¬¼ ì—…ë¡œë“œ</span>
                        </h5>
                      </div>
                      <div className="space-y-3">
                        <select 
                          className="select select-sm select-bordered w-full"
                          value={uploadMetadata.final.fileType}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            final: { ...prev.final, fileType: e.target.value }
                          }))}
                        >
                          <option disabled value="general">ê²°ê³¼ë¬¼ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”</option>
                          <option value="logo-package">ì™„ì„±ëœ ë¡œê³  íŒ¨í‚¤ì§€</option>
                          <option value="brand-guideline">ë¸Œëœë“œ ê°€ì´ë“œë¼ì¸</option>
                          <option value="source-files">ì†ŒìŠ¤ íŒŒì¼ (AI/PSD)</option>
                          <option value="print-ready">ì¸ì‡„ìš© íŒŒì¼</option>
                          <option value="web-ready">ì›¹ìš© íŒŒì¼</option>
                          <option value="other">ê¸°íƒ€</option>
                        </select>
                        <input 
                          type="text" 
                          placeholder="ê²°ê³¼ë¬¼ ì´ë¦„ (ì˜ˆ: ìµœì¢… ë¡œê³  íŒ¨í‚¤ì§€ v1.0)" 
                          className="input input-sm input-bordered w-full"
                          value={uploadMetadata.final.title}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            final: { ...prev.final, title: e.target.value }
                          }))}
                        />
                        <textarea 
                          placeholder="ê²°ê³¼ë¬¼ ì„¤ëª… (ì˜ˆ: AI, PNG, SVG í¬í•¨, ë‹¤ì–‘í•œ ì‚¬ì´ì¦ˆë³„ íŒŒì¼)" 
                          className="textarea textarea-sm textarea-bordered w-full h-16"
                          value={uploadMetadata.final.description}
                          onChange={(e) => setUploadMetadata(prev => ({
                            ...prev,
                            final: { ...prev.final, description: e.target.value }
                          }))}
                        />
                        <div className="flex space-x-2">
                          <input
                            type="file"
                            id="final-file-input"
                            className="hidden"
                            multiple
                            accept="image/*,.pdf,.ai,.psd,.zip"
                            onChange={handleFileSelect('final')}
                          />
                          <button 
                            className="btn btn-success btn-sm"
                            onClick={() => document.getElementById('final-file-input')?.click()}
                          >
                            <span>ğŸ“</span>
                            íŒŒì¼ ì„ íƒ
                            {finalFiles.length > 0 && ` (${finalFiles.length}ê°œ)`}
                          </button>
                          <button 
                            className="btn btn-ghost btn-sm"
                            onClick={() => handleUpload('final', uploadMetadata.final.title, uploadMetadata.final.description, uploadMetadata.final.fileType)}
                            disabled={uploadingStage === 'final'}
                          >
                            {uploadingStage === 'final' ? (
                              <>
                                <span className="loading loading-spinner loading-sm"></span>
                                ì—…ë¡œë“œ ì¤‘...
                              </>
                            ) : (
                              'ìµœì¢… ì œì¶œ'
                            )}
                          </button>
                        </div>
                      </div>
                    </div>
                  )}
                  
                  <div className="mt-4 p-3 bg-info/10 rounded-lg">
                    <div className="flex items-start space-x-2">
                      <span className="text-info">â„¹ï¸</span>
                      <p className="text-sm text-info-content">
                        {userRole === "designer" 
                          ? "ì¤‘ê°„ ì‘ì—…ë¬¼ ìŠ¹ì¸ í›„ ìµœì¢… ê²°ê³¼ë¬¼ì„ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."
                          : "ì¤‘ê°„ ì‘ì—…ë¬¼ ìŠ¹ì¸ í›„ ìµœì¢… ê²°ê³¼ë¬¼ ì œì‘ì´ ì‹œì‘ë©ë‹ˆë‹¤. ì˜ˆìƒ ì™„ë£Œì¼: 2024ë…„ 2ì›” 15ì¼"
                        }
                      </p>
                    </div>
                  </div>
                </div>
              </div>
            </div>


            {/* ì¶”ê°€ íŒŒì¼ ì—…ë¡œë“œ */}
            <div className="card bg-base-100 shadow-sm">
              <div className="card-body">
                <h4 className="font-medium mb-4">ğŸ“ ì¶”ê°€ íŒŒì¼ ì—…ë¡œë“œ</h4>
                <FileUpload
                  onFilesUpload={handleFilesUpload}
                  onFileRemove={handleFileRemove}
                  maxFileSize={50}
                  maxFiles={20}
                  multiple={true}
                  existingFiles={[]}
                  acceptedTypes={[
                    "image/jpeg",
                    "image/png",
                    "image/gif",
                    "image/webp",
                    "application/pdf",
                    "application/vnd.adobe.illustrator",
                    "application/x-photoshop",
                    "application/zip",
                    "text/plain",
                  ]}
                />
              </div>
            </div>

            {/* ì´ë¯¸ì§€ ì£¼ì„ ê¸°ëŠ¥ */}
            <div className="card bg-base-100 shadow-sm">
              <div className="card-body">
                <h4 className="font-medium mb-4 flex items-center space-x-2">
                  <span className="text-xl">ğŸ–¼ï¸</span>
                  <span>ë¡œê³  ì´ˆì•ˆ V2 - ì£¼ì„ ê¸°ëŠ¥</span>
                  <div className="badge badge-primary">ìµœì‹ </div>
                </h4>
                
                {/* ê°„ë‹¨í•œ ì´ë¯¸ì§€ í‘œì‹œ (ìŠ¤í”¼ë„ˆ ì—†ì´) */}
                <div className="relative">
                  <Image 
                    src="https://picsum.photos/800/600?random=2" 
                    alt="ë¡œê³  ì´ˆì•ˆ V2"
                    width={800}
                    height={600}
                    className="w-full max-w-2xl h-auto rounded-lg border border-base-300"
                  />
                  
                  {/* ëª¨ì˜ ì£¼ì„ í‘œì‹œ */}
                  <div className="absolute top-4 left-4 bg-success text-success-content px-2 py-1 rounded-full text-xs font-medium">
                    âœ“ ìƒ‰ìƒ ìŠ¹ì¸ë¨
                  </div>
                  <div className="absolute bottom-4 right-4 bg-warning text-warning-content px-2 py-1 rounded-full text-xs font-medium">
                    ! í°íŠ¸ í¬ê¸° ì¡°ì • í•„ìš”
                  </div>
                </div>
                
                <div className="mt-4 space-y-3">
                  {/* ì£¼ì„ ëª©ë¡ */}
                  <div className="p-3 bg-success/10 border-l-4 border-success rounded">
                    <div className="flex items-start space-x-2">
                      <span className="text-success">âœ“</span>
                      <div>
                        <p className="text-sm font-medium">ìƒ‰ìƒì´ ì¢‹ìŠµë‹ˆë‹¤! ì´ í†¤ì„ ìœ ì§€í•´ì£¼ì„¸ìš”.</p>
                        <p className="text-xs text-base-content/60 mt-1">í´ë¼ì´ì–¸íŠ¸ Â· í•´ê²°ë¨</p>
                      </div>
                    </div>
                  </div>
                  
                  <div className="p-3 bg-warning/10 border-l-4 border-warning rounded">
                    <div className="flex items-start space-x-2">
                      <span className="text-warning">!</span>
                      <div>
                        <p className="text-sm font-medium">í°íŠ¸ í¬ê¸°ë¥¼ ì¡°ê¸ˆ ë” í‚¤ì›Œì£¼ì‹¤ ìˆ˜ ìˆë‚˜ìš”?</p>
                        <p className="text-xs text-base-content/60 mt-1">í´ë¼ì´ì–¸íŠ¸ Â· ê²€í†  ì¤‘</p>
                      </div>
                    </div>
                  </div>
                </div>
                
                <div className="mt-4 p-3 bg-base-200 rounded-lg">
                  <div className="flex items-start space-x-2 text-sm">
                    <span className="text-lg">ğŸ’¡</span>
                    <div>
                      <p className="font-medium mb-1">ì£¼ì„ ê¸°ëŠ¥ ì‚¬ìš©ë²•</p>
                      <ul className="text-base-content/70 space-y-1">
                        <li>â€¢ ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ì—¬ ì£¼ì„ì„ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
                        <li>â€¢ {userRole === "client" ? "í´ë¼ì´ì–¸íŠ¸ëŠ” ì£¼ì„ ì¶”ê°€ ë° ìˆ˜ì •ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤" : "ë””ìì´ë„ˆëŠ” ì£¼ì„ì„ í™•ì¸í•˜ê³  ë‹µë³€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"}</li>
                        <li>â€¢ ì£¼ì„ ìƒíƒœ: ğŸ”´ ê²€í†  ì¤‘, ğŸŸ¢ í•´ê²°ë¨</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            {/* ìƒì„¸ íŒŒì¼ ëª©ë¡ */}
            <div className="card bg-base-100 shadow-sm">
              <div className="card-body">
                <h4 className="font-medium mb-4 flex items-center justify-between">
                  <span className="flex items-center space-x-2">
                    <span className="text-xl">ğŸ“‹</span>
                    <span>ì „ì²´ íŒŒì¼ ëª©ë¡</span>
                  </span>
                  <div className="text-sm text-base-content/60">
                    {(() => {
                      const filteredFiles = getFilteredAndSortedFiles();
                      return `${filteredFiles.length}ê°œ íŒŒì¼ â€¢ ${Math.round(filteredFiles.reduce((acc, f) => acc + f.size, 0) / 1024 / 1024)}MB`;
                    })()}
                  </div>
                </h4>
                <div className="overflow-x-auto">
                  <table className="table table-sm">
                    <thead>
                      <tr>
                        <th>íŒŒì¼ëª…</th>
                        <th>ì¢…ë¥˜</th>
                        <th>í¬ê¸°</th>
                        <th>ì—…ë¡œë“œì¼</th>
                        <th>ìƒíƒœ</th>
                        <th>ì‘ì—…</th>
                      </tr>
                    </thead>
                    <tbody>
                      {getFilteredAndSortedFiles().length === 0 ? (
                        <tr>
                          <td colSpan={6} className="text-center py-8">
                            <div className="text-base-content/50">
                              <div className="text-4xl mb-2">ğŸ”</div>
                              <p className="font-medium">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                              <p className="text-sm">ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ê±°ë‚˜ í•„í„°ë¥¼ ë³€ê²½í•´ë³´ì„¸ìš”</p>
                            </div>
                          </td>
                        </tr>
                      ) : (
                        getFilteredAndSortedFiles().map((file, index) => {
                        const uploadDate = new Date(2024, 0, 15 + index * 2); // Mock dates
                        const getFileCategory = (name: string) => {
                          if (name.includes('logo_design')) return { label: 'ë””ìì¸ ì´ˆì•ˆ', color: 'badge-primary' };
                          if (name.includes('intermediate')) return { label: 'ì¤‘ê°„ ë³´ê³ ì„œ', color: 'badge-warning' };
                          if (name.includes('guideline') || name.includes('deliverables')) return { label: 'ìµœì¢… ê²°ê³¼ë¬¼', color: 'badge-success' };
                          return { label: 'ê¸°íƒ€', color: 'badge-neutral' };
                        };
                        const category = getFileCategory(file.name);
                        
                        return (
                          <tr key={file.id} className="hover">
                            <td>
                              <div className="flex items-center space-x-3">
                                {file.preview ? (
                                  <Image src={file.preview} alt={file.name} width={32} height={32} className="w-8 h-8 object-cover rounded" />
                                ) : (
                                  <div className="w-8 h-8 bg-base-300 rounded flex items-center justify-center text-sm">
                                    {file.type === 'application/pdf' ? 'ğŸ“„' : file.type.includes('zip') ? 'ğŸ“¦' : 'ğŸ“'}
                                  </div>
                                )}
                                <div className="font-medium">{file.name}</div>
                              </div>
                            </td>
                            <td>
                              <div className={`badge ${category.color} badge-sm`}>
                                {category.label}
                              </div>
                            </td>
                            <td className="text-sm">{Math.round(file.size / 1024)}KB</td>
                            <td className="text-sm">{uploadDate.toLocaleDateString()}</td>
                            <td>
                              <div className="badge badge-success badge-sm">âœ“ ì™„ë£Œ</div>
                            </td>
                            <td>
                              <div className="flex space-x-1">
                                {file.preview && (
                                  <button 
                                    className="btn btn-ghost btn-xs" 
                                    title="ë¯¸ë¦¬ë³´ê¸°"
                                    onClick={() => setSelectedImage({
                                      src: file.preview || '',
                                      alt: file.name,
                                      title: file.name,
                                      description: `${category.label} â€¢ ${Math.round(file.size / 1024)}KB â€¢ ${uploadDate.toLocaleDateString()}`
                                    })}
                                  >ğŸ‘ï¸</button>
                                )}
                                <button 
                                  className="btn btn-ghost btn-xs" 
                                  title="ë‹¤ìš´ë¡œë“œ"
                                  onClick={() => handleFileDownload(file)}
                                >â¬‡ï¸</button>
                                <button 
                                  className="btn btn-ghost btn-xs" 
                                  title="ê³µìœ "
                                  onClick={() => handleFileShare(file)}
                                >ğŸ”—</button>
                              </div>
                            </td>
                          </tr>
                        );
                        })
                      )}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        );

      case "history":
        return (
          <div className="space-y-6">
            <h3 className="text-lg font-semibold">ë²„ì „ íˆìŠ¤í† ë¦¬</h3>

            {feedbacks.length > 0 && (
              <div className="tabs tabs-boxed">
                {feedbacks.map((feedback) => (
                  <button
                    key={feedback.id}
                    className="tab"
                    onClick={() => setActiveTab(`history-${feedback.id}`)}
                  >
                    í”¼ë“œë°± #{feedback.id.slice(-3)}
                  </button>
                ))}
              </div>
            )}

            {activeTab.startsWith("history-") ? (
              <FeedbackVersionHistory
                feedbackId={activeTab.replace("history-", "")}
                onVersionRestore={(version) => {
                  console.log(`ë²„ì „ ${version}ìœ¼ë¡œ ë³µì›`);
                }}
                showActions={true}
              />
            ) : (
              <div className="text-center py-12">
                <div className="text-6xl mb-4">ğŸ“œ</div>
                <h3 className="text-xl font-bold mb-2">í”¼ë“œë°±ì„ ì„ íƒí•˜ì„¸ìš”</h3>
                <p className="text-base-content/60">
                  ìœ„ì˜ íƒ­ì—ì„œ í”¼ë“œë°±ì„ ì„ íƒí•˜ë©´ ë²„ì „ íˆìŠ¤í† ë¦¬ë¥¼ í™•ì¸í•  ìˆ˜
                  ìˆìŠµë‹ˆë‹¤.
                </p>
              </div>
            )}
          </div>
        );

      default:
        return <div>íƒ­ì„ ì„ íƒí•˜ì„¸ìš”</div>;
    }
  };


  return (
    <AuthWrapper requireAuth>
      <DashboardLayout title={project.name} userRole={userRole}>
        <div className="space-y-6">
          {/* í”„ë¡œì íŠ¸ í—¤ë” */}
          <div className="card bg-base-100 shadow-sm">
            <div className="card-body">
              <div className="flex items-start justify-between">
                <div className="flex-1">
                  <h1 className="text-2xl font-bold mb-2">{project.name}</h1>
                  <p className="text-base-content/70 mb-4">
                    {project.description}
                  </p>

                  <div className="flex items-center space-x-4 text-sm">
                    <span
                      className={`badge badge-${statusInfo.color} badge-lg`}
                    >
                      {statusInfo.icon} {statusInfo.label}
                    </span>
                    <span>ì§„í–‰ë¥ : {progress}%</span>
                    <span>
                      ë§ˆê°: {new Date(project.end_date).toLocaleDateString()}
                    </span>
                  </div>
                </div>

                <div className="flex items-center space-x-2">
                  <button
                    onClick={() => router.push("/projects")}
                    className="btn btn-ghost"
                  >
                    â† ëª©ë¡ìœ¼ë¡œ
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}
          <div className="tabs tabs-boxed justify-start">
            <button
              className={`tab tab-lg ${
                activeTab === "overview" ? "tab-active" : ""
              }`}
              onClick={() => setActiveTab("overview")}
            >
              ğŸ“Š ê°œìš”
            </button>
            <button
              className={`tab tab-lg ${
                activeTab === "feedback" ? "tab-active" : ""
              }`}
              onClick={() => setActiveTab("feedback")}
            >
              ğŸ“ í”¼ë“œë°± & ìˆ˜ì •ìš”ì²­ ({feedbacks.length})
            </button>
            <button
              className={`tab tab-lg ${
                activeTab === "versions" ? "tab-active" : ""
              }`}
              onClick={() => setActiveTab("versions")}
            >
              ğŸ¨ ì‹œì•ˆ ë²„ì „
            </button>
            <button
              className={`tab tab-lg ${
                activeTab === "files" ? "tab-active" : ""
              }`}
              onClick={() => setActiveTab("files")}
            >
              ğŸ“ íŒŒì¼
            </button>
            <button
              className={`tab tab-lg ${
                activeTab === "history" ? "tab-active" : ""
              }`}
              onClick={() => setActiveTab("history")}
            >
              ğŸ“œ íˆìŠ¤í† ë¦¬
            </button>
          </div>

          {/* íƒ­ ë‚´ìš© */}
          {renderTabContent()}
        </div>

        {/* ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ */}
        {selectedImage && (
          <div className="modal modal-open">
            <div className="modal-box max-w-4xl">
              <div className="flex items-center justify-between mb-4">
                <h3 className="font-bold text-lg">{selectedImage.title}</h3>
                <button 
                  className="btn btn-ghost btn-sm"
                  onClick={() => setSelectedImage(null)}
                >
                  âœ•
                </button>
              </div>
              
              <div className="flex flex-col items-center">
                <Image 
                  src={selectedImage.src} 
                  alt={selectedImage.alt}
                  width={600}
                  height={400}
                  className="max-w-full max-h-96 object-contain rounded-lg shadow-lg"
                />
                
                {selectedImage.description && (
                  <p className="text-sm text-base-content/70 mt-3 text-center">
                    {selectedImage.description}
                  </p>
                )}
                
                <div className="flex space-x-2 mt-4">
                  <button 
                    className="btn btn-primary btn-sm"
                    onClick={() => {
                      const mockFile = { name: selectedImage.title || selectedImage.alt };
                      handleFileDownload(mockFile);
                    }}
                  >
                    â¬‡ï¸ ë‹¤ìš´ë¡œë“œ
                  </button>
                  <button 
                    className="btn btn-ghost btn-sm"
                    onClick={() => {
                      const mockFile = { 
                        id: `preview-${Date.now()}`,
                        name: selectedImage.title || selectedImage.alt 
                      };
                      handleFileShare(mockFile);
                    }}
                  >
                    ğŸ”— ê³µìœ 
                  </button>
                  <button 
                    className="btn btn-ghost btn-sm"
                    onClick={() => setSelectedImage(null)}
                  >
                    ë‹«ê¸°
                  </button>
                </div>
              </div>
            </div>
            <div className="modal-backdrop" onClick={() => setSelectedImage(null)}>
            </div>
          </div>
        )}
      </DashboardLayout>
    </AuthWrapper>
  );
}
